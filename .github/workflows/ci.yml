name: CI

on:
  push:
  pull_request:

jobs:
  build-and-run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y grub-pc-bin xorriso qemu-system-x86 make

      - name: Build ISO
        run: make iso

      - name: Run headless and verify serial output
        run: |
          timeout 10s make run-headless > qemu.log 2>&1 || true
          cat qemu.log
          grep -q "EEE-OS booted" qemu.log
